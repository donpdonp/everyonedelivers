<%# form_for :delivery, @delivery, :url => delivery_path(@delivery), :method => "put" do |f| %>
<% form_for @delivery do |f| %>
  <p>
    Editing Delivery #<%= @delivery.id %>
  </p>
  <fieldset>
    <legend>Package</legend>
    Description <%= text_field_tag "package[description]", 
                    @delivery.package ? @delivery.package.description : "", :size => 50 %>

   <!--
    <br/>
    Dimentions in inches Height: <%= text_field_tag "package[height]", 
                                     (@delivery.package && @delivery.package.height_in_meters)? @delivery.package.height : "", 
                                     :size => 5 %>
    Width: <%= text_field_tag "package[width]", 
               (@delivery.package && @delivery.package.width_in_meters) ? @delivery.package.width : "", :size => 5 %>
    Depth: <%= text_field_tag "package[depth]", 
               (@delivery.package && @delivery.package.depth_in_meters) ? @delivery.package.depth : "", :size => 5 %>
    <br/>
    Weight in ounces <%= text_field_tag "package[weight]", 
                         (@delivery.package && @delivery.package.weight_in_grams)? @delivery.package.weight : "", :size => 5 %>
    -->
    <br/>
    If delivery person will be purchasing item from a store, give the retail price. <br/>
    Retail Price $<%= text_field_tag "package[display_price]", 
                         @delivery.package ? @delivery.package.display_price : "", :size => 5 %>
  </fieldset>
  
  <fieldset>
    <legend>From Address</legend>
    Example: 900 SW Main, Portland, Or <br/>
    <span style="float:left">
    Address <%= text_field_tag "from[address]", 
                @delivery.start_location ? @delivery.start_location.street : "", :size => 50 %>
    </span>
    <%= button_to "Validate", {}, {:onclick=>"geocoder.getLatLng($('from_address').value, geocallback_from); return false;",
                                   :style => "float: left"} %>
    <span id="from_address_msg"></span>
    <%= hidden_field_tag "from[latitude]", ""%>
    <%= hidden_field_tag "from[longitude]", ""%>
  </fieldset>

  <fieldset>
    <legend>To Address</legend>
    <span style="float:left">
    Address <%= text_field_tag "to[address]", 
                @delivery.end_location ? @delivery.end_location.street : "", :size => 50 %>
    </span>
    <%= button_to "Validate", {}, {:onclick=>"geocoder.getLatLng($('to_address').value, geocallback_to); return false;",
                                   :style => "float: left"} %>
    <span id="to_address_msg"></span>
    <%= hidden_field_tag "to[latitude] "%>
    <%= hidden_field_tag "to[longitude] "%>
  </fieldset>
  <fieldset>
    <legend> Delivery Price </legend>
    Price $<%= text_field_tag "fee[display_price]", 
               @delivery.fee ? @delivery.fee.display_price : "0.00", :size => 2 %>
    if delivery is completed by
    <%= datetime_select("fee","delivery_due", :default => @delivery.fee ? @delivery.fee.delivery_due : Time.now) %>
<!--    if delivered within
    <%= select_tag "fee[time_count]", options_for_select({"1" => "1","2" => "2",
                                                          "3" => "3","4" => "4"}) %>
    <%= select_tag "fee[time_unit]", options_for_select({"Hour(s)" => "hour"})%>
-->
  </fieldset>

  <br/>
  <%= f.submit "Save Details", :onclick => "formvalidation($('edit_delivery_#{@delivery.id}'));return false;" %>
  <br/>
<% end %>
<%= button_to "Cancel Listing", delivery_path(@delivery), :confirm => "Are you sure?", :method => :delete %>

<script>
geocoder = new GClientGeocoder();
function formvalidation(form) {
  alert('from_lat: '+$('from_latitude').value+' to_lat:'+$('to_latitude').value);
  if($('from_latitude').value.length > 0) {
    if($('to_latitude').value.length > 0) {
      form.submit();
    } else {
      alert("Validate the To address");
    }
  } else {
    alert("Validate the From address");
  }
}

function geocallback_from(gLatLng) {
  if(gLatLng) {
    $('from_address_msg').innerHTML = "Address OK.";
    $('from_latitude').value = ""+gLatLng.lat();
    $('from_longitude').value = ""+gLatLng.lng();
  } else {
    $('from_address_msg').innerHTML = "Google does not recognize this address. Please fix.";
    $('from_latitude').value = "";
    $('from_longitude').value = "";
  }
}
function geocallback_to(gLatLng) {
  if(gLatLng) {
    $('to_address_msg').innerHTML = "Address OK.";
    $('to_latitude').value = ""+gLatLng.lat();
    $('to_longitude').value = ""+gLatLng.lng();
  } else {
    $('to_address_msg').innerHTML = "Google does not recognize this address. Please fix.";
    $('to_latitude').value = "";
    $('to_longitude').value = "";
  }
}
</script>
